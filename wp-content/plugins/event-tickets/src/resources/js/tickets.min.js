void 0===tribe.tickets&&(tribe.tickets={}),tribe.tickets.editor={};var ticketHeaderImage=window.ticketHeaderImage||{};!function(d,o,c,a){"use strict";o("html, body");var n=o(document),s=o(document.getElementById("tribetickets"));if(0!==s.length){var e=o(document.getElementById("event_tickets")),r=o(document.getElementById("post_ID")),t=o(document.getElementById("publish")),i=s.find(".tribe-tickets-editor-blocker"),l=s.find(".spinner"),_=o(document.getElementById("tribe_panel_base")),m=o(document.getElementById("tribe_panel_edit")),p=o(document.getElementById("tribe_panel_settings")),u=["yy-mm-dd","m/d/yy","mm/dd/yy","d/m/yy","dd/mm/yy","m-d-yy","mm-dd-yy","d-m-yy","dd-mm-yy","yy.mm.dd","mm.dd.yy","dd.mm.yy"],f=u[0];a.beforeUnload=function(e){var t=!1;return"true"===_.attr("aria-hidden")&&(t=tribe_global_stock_admin_ui.nav_away_msg),e.returnValue=t},ticketHeaderImage={uploader:function(){var t=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return t.on("close",function(){var e=t.state().get("selection").toJSON();e.length&&ticketHeaderImage.render(e[0])}),t.open(),!1},render:function(e){o(document.getElementById("tribe_ticket_header_preview")).html(ticketHeaderImage.imgHTML(e)),o(document.getElementById("tribe_ticket_header_image_id")).val(e.id),o(document.getElementById("tribe_ticket_header_remove")).show(),o(document.getElementById("tribe_tickets_image_preview_filename")).show().find(".filename").text(e.filename)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',t+="/>"}},a.panels={list:"#tribe_panel_base",ticket:"#tribe_panel_edit",settings:"#tribe_panel_settings"},a.swapPanel=function(e){var t;t=e instanceof jQuery?e:void 0!==a.panels[e]?o(a.panels[e]):_;var i=o("#event_tickets");i.trigger("before_panel_swap.tickets",{panel:t}),s.find(".ticket_panel").each(function(){o(this).attr("aria-hidden",!0)}),t.attr("aria-hidden",!1),t.is(_)?(o(d).off("beforeunload.tribe"),n.trigger("tribe.dependencies-run")):o(d).on("beforeunload.tribe",a.beforeUnload),i.trigger("after_panel_swap.tickets",{panel:t})},a.fetchPanels=function(e,t){void 0===e&&(e=[]);var i={action:"tribe-ticket-panels",notice:!1,post_id:r.val(),nonce:TribeTickets.add_ticket_nonce,data:e,is_admin:o("body").hasClass("wp-admin")};o.post(ajaxurl,i,function(e){e.success&&a.refreshPanels(e.data,t)},"json")},a.startWatchingMoveLinkIn=function(){e.find(".tribe-ticket-move-link").one("click",function(){d.setTimeout(a.listentToThickboxEvents,250)})},a.listentToThickboxEvents=function(){var e=o("#TB_window");0!==e.length&&e.one("tb_unload",function(){a.fetchPanels(null,"list")})},a.refreshPanels=function(e,t){_=o(e.list),m=o(e.ticket),p=o(e.settings),s.find(a.panels.list).replaceWith(_),s.find(a.panels.ticket).replaceWith(m),s.find(a.panels.settings).replaceWith(p),a.setupPanels(),a.swapPanel(t)},a.setupPanels=function(){d.MTAccordion({target:".accordion"});var e=o(document.getElementById("tribe-event-datepickers")),n=o(document.getElementById("ticket_start_date")),a=o(document.getElementById("ticket_end_date"));o(document.getElementById("ticket_start_time")),o(document.getElementById("ticket_end_time")),d.tribe_datepicker_opts;if(e.length&&e.data("startofweek"),"undefined"!=typeof tribe_ticket_datepicker_format){var t=o.isNumeric(tribe_ticket_datepicker_format.datepicker_format_index)?tribe_ticket_datepicker_format.datepicker_format_index:0;f=u[t]}var i={dateFormat:f,showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,showButtonPanel:!1,onChange:function(){},beforeShow:function(e,t){t.input.data("prevDate",t.input.datepicker("getDate"));var i=o(t.dpDiv);i.addClass("tribe-ui-datepicker"),i.attrchange({trackValues:!0,callback:function(e){(0<=e.newValue.indexOf("display: none")||0<=e.newValue.indexOf("display:none"))&&i.removeClass("tribe-ui-datepicker")}})},onSelect:function(e,t){var i=o.datepicker.parseDate(f,e);"ticket_start_date"===t.id?a.datepicker("option","minDate",i):n.datepicker("option","maxDate",i)}};o.extend(i,tribe_l10n_datatables.datepicker);var r=s.find(".tribe-timepicker:not(.ui-timepicker-input)");if(tribe_timepickers.setup_timepickers(r),n.datepicker(i).datepicker("option","defaultDate",o(document.getElementById("EventStartDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||o.datepicker._clearDate(this)}),a.datepicker(i).datepicker("option","defaultDate",o(document.getElementById("EventEndDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||o.datepicker._clearDate(this)}),o(document.getElementById("tribe_ticket_header_preview")).find("img").length){o(document.getElementById("tribe_ticket_header_remove")).show();var c=o(document.getElementById("tribe_ticket_header_preview")).find("img");c.removeAttr("width").removeAttr("height"),s.width()<c.width()&&c.css("width","95%")}"undefined"!=typeof tribe_event_tickets_plus&&o.isPlainObject(tribe_event_tickets_plus)&&o.isPlainObject(tribe_event_tickets_plus.meta)&&o.isPlainObject(tribe_event_tickets_plus.meta.admin)&&o.isFunction(tribe_event_tickets_plus.meta.admin.init_ticket_fields)&&tribe_event_tickets_plus.meta.admin.init_ticket_fields(),tribe.tickets.table&&0!==_.find(".tribe-tickets-editor-table-tickets-body tr").length&&tribe.tickets.table.toggle_sortable(),s.find(tribe.validation.selectors.item).validation(),s.find(".tribe-dependent").dependency(),s.find(".tribe-dependency").trigger("verify.dependency")},n.ajaxSend(function(e,t,i){"string"===o.type(i.data)&&-1!==i.data.indexOf("action=tribe-ticket")&&s.trigger("spin.tribe","start")}),n.ajaxComplete(function(e,t,i){"string"===o.type(i.data)&&-1!==i.data.indexOf("action=tribe-ticket")&&s.trigger("spin.tribe","stop")}),n.on({"spin.tribe":function(e,t){(void 0===t||o.inArray(t,["start","stop"]))&&(t="stop"),"stop"===t?(i.hide(),l.removeClass("is-active")):(i.show(),l.addClass("is-active"))}}),t.on("click",function(e){o(d).off("beforeunload.tribe")}),n.on("click","#settings_form_toggle",function(e){return e.preventDefault(),a.fetchPanels(null,"settings"),!1}),n.on("click","#tribe_settings_form_cancel, #ticket_form_cancel",function(e){return e.preventDefault(),a.fetchPanels(null,"list"),!1}),n.on("click","#tribe_settings_form_save",function(e){e.preventDefault();var t=p.find("input,textarea").serialize();return a.fetchPanels(t,"list"),!1}),n.on("click",".ticket_form_toggle",function(e){return e.preventDefault(),function(e){void 0===e&&(e=!0);var t,i=s.find(".tribe-ticket-editor-field-default_provider");i.is(":radio")&&(i=i.filter(":checked")),t=e?"Tribe__Tickets__RSVP_radio":"Tribe__Tickets_Plus__Commerce__WooCommerce__Main_radio",!e&&0<i.length&&(t=i.val()+"_radio"),o(document.getElementById(t)).prop("checked",!0).trigger("change")}("rsvp_form_toggle"===o(this).attr("id")),m.find(".tribe-dependency").trigger("verify.dependency"),a.swapPanel("ticket"),!1}),n.on("click",".ticket_edit_button",function(e){e.preventDefault();var t=o(this),i={action:"tribe-ticket-edit",post_id:r.val(),ticket_id:t.data("ticketId"),nonce:TribeTickets.edit_ticket_nonce,is_admin:o("body").hasClass("wp-admin")};return o.post(ajaxurl,i,function(e){e.success&&(a.refreshPanels(e.data,"ticket"),a.startWatchingMoveLinkIn("#event_tickets"))},"json"),!1}),n.on("click.tribe",'[name="ticket_form_save"]',function(e){var t=o(document.getElementById("ticket_form_table"));if(t.trigger("validation.tribe"),!tribe.validation.hasErrors(t)){s.trigger("pre-save-ticket.tribe",e);var i=_.find(".tribe-ticket-field-order"),n={action:"tribe-ticket-add",data:m.find("input,textarea").serialize(),post_id:r.val(),nonce:TribeTickets.add_ticket_nonce,menu_order:i.length,is_admin:o("body").hasClass("wp-admin")};o.post(ajaxurl,n,function(e){e.success&&a.refreshPanels(e.data)},"json")}}),n.on("click",".ticket_delete",function(e){if(!confirm(tribe_ticket_notices.confirm_alert))return!1;e.preventDefault(),s.trigger("delete-ticket.tribe",e);var t=o(this).attr("attr-ticket-id"),i={action:"tribe-ticket-delete",post_id:r.val(),ticket_id:t,nonce:TribeTickets.remove_ticket_nonce,is_admin:o("body").hasClass("wp-admin")};o.post(ajaxurl,i,function(e){e.success&&a.refreshPanels(e.data)},"json")}),n.on("change",".tribe-ticket-field-capacity",function(e){var t=o(this),i=t.parents(".input_block").eq(0).find(".tribe-ticket-field-mode");t.val()&&i.val("capped")}),n.on("keyup","#ticket_price",function(e){e.preventDefault();var t=price_format.decimal,i=new RegExp("[^-0-9%\\"+t+"]+","gi"),n=o(this).val(),a=n.replace(i,"");n!==a&&o(this).val(a)}),n.on("click","#tribe_ticket_header_image, #tribe_ticket_header_preview",function(e){e.preventDefault(),ticketHeaderImage.uploader("","")}),n.on("focus","#settings_global_capacity_edit",function(){var e=o(this),t=0;o(".tribe-tickets-editor-capacity-table").find("[data-capacity]").each(function(){var e=o(this);t+=parseInt(e.data("capacity"),10)}),e.data("nonSharedCapacity",t)}),n.on("blur change","#settings_global_capacity_edit",function(){var e=o(".tribe-tickets-editor-table-row-capacity-total");if(-1!==parseInt(e.data("totalCapacity"),10)){var t=o(this),i=e.find(".tribe-tickets-editor-total-capacity"),n=parseInt(t.val(),10),a=t.data("nonSharedCapacity");(""===n||n<0||c.isNaN(n))&&(n=0);var r=a+n;i.text(r)}}),n.on("click","#global_capacity_edit_button",function(e){e.preventDefault(),o(document.getElementById("settings_global_capacity_edit")).prop("disabled",!1).focus()}),n.on("blur",'[name="tribe-ticket[event_capacity]"]',function(e,t){void 0===t&&(t=o(this).val());if(void 0!==t){t||(t=0),t=parseInt(t,10);var i=o(".tribe-ticket-capacity-max").find(".tribe-ticket-capacity-value"),n=o('.tribe-ticket-field-capacity[name="tribe-ticket[capacity]"]');n.attr("placeholder",t),t?n.attr("max",t):t=0,i.text(t)}}),n.on("change",'[name="tribe-ticket[capacity]"]',function(e){var t=o(this),i=parseInt(t.attr("max"),10),n=parseInt(t.val(),10);i&&i<n&&t.val(i)}),n.on("click","#tribe_ticket_header_remove",function(e){e.preventDefault(),o(document.getElementById("tribe_ticket_header_preview")).html(""),o(document.getElementById("tribe_ticket_header_remove")).hide(),o(document.getElementById("tribe_tickets_image_preview_filename")).hide().find(".filename").text(""),o(document.getElementById("tribe_ticket_header_image_id")).val("")}),n.ready(function(){a.setupPanels()})}}(window,jQuery,_,tribe.tickets.editor);